{% extends 'pc/base.html' %}
{% block content %}
<div class="container mt-4">
  <h3>Manage Dataset</h3>
  <form method="post" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">{{ form.dataset_name.label_tag }} {{ form.dataset_name }}</div>
    <div class="mb-3">{{ form.title.label_tag }} {{ form.title }}</div>
    <div class="mb-3">{{ form.content.label_tag }} {{ form.content }}</div>
    <div class="mb-3">{{ form.source_file.label_tag }} {{ form.source_file }}</div>
    <button type="submit" class="btn btn-primary">Save Document</button>
  </form>

  <hr/>
  <form method="post" action="{% url 'train_dataset' %}" class="mt-3">
    {% csrf_token %}
    <div class="input-group" style="max-width: 480px;">
      <input type="text" class="form-control" name="dataset_name" placeholder="Dataset name" required>
      <button type="submit" class="btn btn-success">Train TF-IDF Model</button>
    </div>
  </form>

  <h5 class="mt-4">Recent Documents</h5>
  <ul>
  {% for d in recent_docs %}
    <li>[{{ d.dataset_name }}] {{ d.title }}</li>
  {% empty %}
    <li>No documents yet.</li>
  {% endfor %}
  </ul>

  <h5 class="mt-4">Dataset Status</h5>
  <table class="table table-sm">
    <thead>
      <tr>
        <th>Dataset</th>
        <th>Docs</th>
        <th>Trained</th>
        <th>Trained At</th>
      </tr>
    </thead>
    <tbody>
    {% for row in dataset_status %}
      <tr>
        <td>{{ row.dataset_name }}</td>
        <td>{{ row.num_docs }}</td>
        <td>{% if row.trained %}Yes{% else %}No{% endif %}</td>
        <td>{% if row.trained_at %}{{ row.trained_at }}{% else %}-{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="4">No datasets yet.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

